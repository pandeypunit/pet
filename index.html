<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purrfect Pal - Virtual Pet</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --primary-dark: #EE5253;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --bg-gradient: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%);
            --card-bg: rgba(255, 255, 255, 0.85);
            --text: #2D3436;
            --text-light: #636E72;
            --danger: #FF7675;
            --success: #55EFC4;
            --warning: #FDCB6E;
            --info: #74B9FF;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Fredoka', sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            background: var(--bg-gradient);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .main-wrapper {
            display: flex;
            gap: 2rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1200px;
            width: 100%;
            padding: 1rem;
        }

        .game-container {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            width: 100%;
            max-width: 450px;
            height: 90vh;
            max-height: 850px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-radius: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.4);
            flex-shrink: 0;
        }

        .shop-container {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            width: 100%;
            max-width: 350px;
            height: 80vh;
            max-height: 700px;
            border-radius: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.4);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .shop-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .coin-display {
            background: var(--warning);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .shop-items {
            overflow-y: auto;
            flex: 1;
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding-right: 0.5rem;
        }

        .shop-items::-webkit-scrollbar {
            width: 6px;
        }

        .shop-items::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 1rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .shop-item:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .shop-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .item-icon {
            font-size: 2rem;
            background: var(--bg-gradient);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: 700;
            color: var(--text);
            font-size: 1rem;
        }

        .item-desc {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .item-price {
            font-weight: 700;
            color: var(--warning);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Accessories on Cat */
        .cat-accessory {
            pointer-events: none;
            transition: all 0.3s;
        }

        .accessory-bow {
            fill: #FF7675;
        }

        .accessory-glasses {
            fill: none;
            stroke: #2D3436;
            stroke-width: 3;
        }

        .accessory-hat {
            fill: #6C5CE7;
        }

        @media (max-width: 850px) {
            .main-wrapper {
                flex-direction: column;
                height: auto;
                overflow-y: auto;
                padding-top: 2rem;
            }

            .game-container {
                height: 80vh;
            }

            .shop-container {
                height: auto;
                width: 100%;
                max-width: 450px;
            }

            body {
                align-items: flex-start;
                overflow-y: auto;
            }
        }

        /* Header & Stats */
        .header {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0 0 2.5rem 2.5rem;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        h1 {
            color: var(--primary-dark);
            font-weight: 700;
            font-size: 1.75rem;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        .level-badge {
            background: var(--accent);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 1rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .xp-bar-container {
            margin-top: 1rem;
            background: rgba(0, 0, 0, 0.05);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid white;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            width: 0%;
            transition: width 0.5s ease-out;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            padding: 1.5rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.6);
            padding: 1rem;
            border-radius: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            border: 2px solid white;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.05);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 700;
            display: flex;
            justify-content: space-between;
        }

        .progress-bar {
            height: 12px;
            background: #F0F2F5;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .progress-fill {
            height: 100%;
            width: 100%;
            border-radius: 6px;
            transition: width 0.3s ease, background-color 0.3s ease;
            background-image: linear-gradient(45deg, rgba(255, 255, 255, .15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .15) 50%, rgba(255, 255, 255, .15) 75%, transparent 75%, transparent);
            background-size: 1rem 1rem;
        }

        /* Main Scene */
        .scene {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.8) 0%, transparent 70%);
        }

        /* SVG Cat Styles */
        #cat-svg {
            width: 280px;
            height: 280px;
            cursor: pointer;
            transition: transform 0.1s;
            filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.1));
        }

        #cat-svg:active {
            transform: scale(0.95);
        }

        .cat-body {
            fill: #E0E0E0;
        }

        .cat-belly {
            fill: #FFFFFF;
        }

        .cat-eye {
            fill: #2D3436;
        }

        .cat-nose {
            fill: #FF7675;
        }

        .cat-ear {
            fill: #E0E0E0;
        }

        .cat-ear-inner {
            fill: #FF7675;
        }

        .cat-tail {
            fill: none;
            stroke: #E0E0E0;
            stroke-width: 20;
            stroke-linecap: round;
        }

        /* Animations */
        @keyframes breathe {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(1.03);
            }
        }

        @keyframes tail-wag {

            0%,
            100% {
                transform: rotate(-8deg);
            }

            50% {
                transform: rotate(8deg);
            }
        }

        @keyframes blink {

            0%,
            90%,
            100% {
                transform: scaleY(1);
            }

            95% {
                transform: scaleY(0.1);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        .animate-breathe {
            animation: breathe 3s infinite ease-in-out;
            transform-origin: bottom center;
        }

        .animate-tail {
            animation: tail-wag 2s infinite ease-in-out;
            transform-origin: 20% 80%;
        }

        .animate-blink {
            animation: blink 4s infinite;
            transform-origin: center;
        }

        .animate-float {
            animation: float 3s infinite ease-in-out;
        }

        @keyframes run-away {
            0% {
                transform: translateX(0) scaleX(1);
            }

            20% {
                transform: translateX(-20px) scaleX(1);
            }

            /* Anticipation */
            25% {
                transform: translateX(-20px) scaleX(-1);
            }

            /* Turn around */
            100% {
                transform: translateX(1000px) scaleX(-1);
            }

            /* Run off */
        }

        .animate-run-away {
            animation: run-away 2s forwards ease-in;
        }

        @keyframes digging {

            0%,
            100% {
                transform: translateY(0) rotate(0);
            }

            25% {
                transform: translateY(5px) rotate(-5deg);
            }

            75% {
                transform: translateY(5px) rotate(5deg);
            }
        }

        @keyframes dust-rise {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(-40px) scale(1.5);
                opacity: 0;
            }
        }

        .animate-digging {
            animation: digging 0.2s infinite;
        }

        .dust-particle {
            position: absolute;
            background: #B2BEC3;
            border-radius: 50%;
            pointer-events: none;
            animation: dust-rise 1s forwards;
            z-index: 90;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 2rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .cat-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .cat-option {
            background: rgba(255, 255, 255, 0.5);
            padding: 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .cat-option:hover,
        .cat-option.selected {
            background: white;
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .cat-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 0.5rem;
        }

        .close-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .close-btn:hover {
            transform: scale(1.05);
        }

        /* Controls */
        .controls {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 2.5rem 2.5rem 0 0;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.05);
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
        }

        .btn {
            border: none;
            background: white;
            padding: 0.75rem 0.25rem;
            border-radius: 1.25rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            transition: all 0.1s;
            color: var(--text);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.1);
        }

        /* Button Specific Colors */
        .btn:nth-child(1) {
            color: #E67E22;
        }

        /* Feed */
        .btn:nth-child(1):hover {
            background: #FFF3E0;
            border-color: #E67E22;
        }

        .btn:nth-child(2) {
            color: #6C5CE7;
        }

        /* Sleep */
        .btn:nth-child(2):hover {
            background: #ECE9FF;
            border-color: #6C5CE7;
        }

        .btn:nth-child(3) {
            color: #E84393;
        }

        /* Play */
        .btn:nth-child(3):hover {
            background: #FDE6F0;
            border-color: #E84393;
        }

        .btn:nth-child(4) {
            color: #00B894;
        }

        /* Clean */
        .btn:nth-child(4):hover {
            background: #E0F9F4;
            border-color: #00B894;
        }

        .btn:nth-child(5) {
            color: #636E72;
        }

        /* Mute */
        .btn:nth-child(5):hover {
            background: #F0F2F5;
            border-color: #636E72;
        }

        .btn-icon {
            font-size: 1.75rem;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));
        }

        .btn-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Particles */
        .particle {
            position: absolute;
            pointer-events: none;
            animation: rise-fade 1s forwards;
            font-size: 2rem;
            filter: drop-shadow(0 4px 4px rgba(0, 0, 0, 0.1));
            z-index: 100;
        }

        @keyframes rise-fade {
            0% {
                transform: translateY(0) scale(0.5) rotate(0deg);
                opacity: 0;
            }

            20% {
                transform: translateY(-20px) scale(1.2) rotate(10deg);
                opacity: 1;
            }

            100% {
                transform: translateY(-100px) scale(1) rotate(-10deg);
                opacity: 0;
            }
        }

        /* Mood States */
        .mood-happy .cat-eye {
            clip-path: none;
        }

        .mood-sad .cat-eye {
            clip-path: polygon(0 40%, 100% 0, 100% 100%, 0 100%);
        }

        .mood-sleep .cat-eye {
            transform: scaleY(0.1);
            animation: none;
        }

        /* Notifications */
        .toast {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background: white;
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 1rem;
            font-weight: 700;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            pointer-events: none;
            border: 2px solid var(--primary);
        }

        .toast.show {
            transform: translateX(-50%) scale(1);
            opacity: 1;
            top: 120px;
        }

        /* Dead State */
        .game-over {
            position: absolute;
            inset: 0;
            background: rgba(45, 52, 54, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .game-over.visible {
            opacity: 1;
            pointer-events: all;
        }

        .restart-btn {
            margin-top: 1.5rem;
            padding: 1rem 3rem;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 2rem;
            font-weight: 700;
            font-size: 1.25rem;
            cursor: pointer;
            box-shadow: 0 6px 0 #00B894;
            transition: transform 0.1s;
        }

        .restart-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #00B894;
        }
    </style>
</head>

<body>

    <div class="main-wrapper">
        <div class="game-container">
            <div class="header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h1 style="font-size: 1.25rem;">Purrfect Pal</h1>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <button class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;"
                            onclick="game.openPetSelect()">üê± Swap</button>
                        <div class="level-badge">
                            <span>‚≠ê Lvl <span id="level-display">1</span></span>
                        </div>
                    </div>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar-fill" id="xp-bar"></div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label"><span>Hunger</span> <span id="hunger-val">100%</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="hunger-bar" style="background: var(--success);"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>Energy</span> <span id="energy-val">100%</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="energy-bar" style="background: var(--success);"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>Fun</span> <span id="fun-val">100%</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="fun-bar" style="background: var(--success);"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>Hygiene</span> <span id="hygiene-val">100%</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="hygiene-bar" style="background: var(--success);"></div>
                    </div>
                </div>
            </div>

            <div class="scene">
                <!-- SVG Cat -->
                <svg id="cat-svg" viewBox="0 0 200 200" class="animate-float">
                    <g class="animate-breathe">
                        <!-- Tail -->
                        <path d="M 140 150 Q 170 120 160 90" class="cat-tail animate-tail" />

                        <!-- Body -->
                        <ellipse cx="100" cy="140" rx="50" ry="45" class="cat-body" />
                        <ellipse cx="100" cy="145" rx="30" ry="35" class="cat-belly" />

                        <!-- Head Group -->
                        <g transform="translate(0, -10)">
                            <!-- Ears -->
                            <path d="M 70 75 L 60 40 L 90 65 Z" class="cat-ear" />
                            <path d="M 130 75 L 140 40 L 110 65 Z" class="cat-ear" />
                            <path d="M 72 70 L 65 50 L 85 65 Z" class="cat-ear-inner" />
                            <path d="M 128 70 L 135 50 L 115 65 Z" class="cat-ear-inner" />

                            <!-- Head Base -->
                            <circle cx="100" cy="85" r="40" class="cat-body" />

                            <!-- Face -->
                            <g id="face-features">
                                <!-- Eyes -->
                                <g class="animate-blink">
                                    <circle cx="85" cy="80" r="4" class="cat-eye" />
                                    <circle cx="115" cy="80" r="4" class="cat-eye" />
                                </g>

                                <!-- Nose -->
                                <path d="M 96 90 L 104 90 L 100 95 Z" class="cat-nose" />

                                <!-- Mouth -->
                                <path id="mouth" d="M 96 98 Q 100 102 104 98" stroke="#1F2937" stroke-width="2"
                                    fill="none" stroke-linecap="round" />

                                <!-- Whiskers -->
                                <g stroke="#1F2937" stroke-width="1" opacity="0.5">
                                    <line x1="60" y1="85" x2="80" y2="88" />
                                    <line x1="60" y1="92" x2="80" y2="92" />
                                    <line x1="140" y1="85" x2="120" y2="88" />
                                    <line x1="140" y1="92" x2="120" y2="92" />
                                </g>
                            </g>
                            <!-- Accessories Container -->
                            <g id="accessories-layer"></g>
                        </g>
                    </g>
                </svg>
            </div>

            <div class="controls">
                <button class="btn" onclick="game.interact('feed')">
                    <span class="btn-icon">üêü</span>
                    <span class="btn-label">Feed</span>
                </button>
                <button class="btn" onclick="game.interact('sleep')">
                    <span class="btn-icon">üí§</span>
                    <span class="btn-label">Sleep</span>
                </button>
                <button class="btn" onclick="game.interact('play')">
                    <span class="btn-icon">üß∂</span>
                    <span class="btn-label">Play</span>
                </button>
                <button class="btn" onclick="game.interact('clean')">
                    <span class="btn-icon">‚ú®</span>
                    <span class="btn-label">Clean</span>
                </button>
            </div>

            <div class="toast" id="toast">Level Up!</div>

            <div class="game-over" id="game-over">
                <h2>Oh no!</h2>
                <p>Your pet ran away...</p>
                <button class="restart-btn" onclick="game.restart()">Try Again</button>
            </div>
        </div>

        <div class="shop-container">
            <div class="shop-header">
                <span>Cat Shop</span>
                <div class="coin-display">
                    <span>ü™ô</span>
                    <span id="coin-display">0</span>
                </div>
            </div>
            <div class="shop-items" id="shop-items">
                <!-- Items injected by JS -->
            </div>
        </div>

        <div class="modal-overlay" id="cat-select-modal">
            <div class="modal-content">
                <h2>Choose Your Pal</h2>
                <div class="cat-options" id="cat-options">
                    <!-- Options injected by JS -->
                </div>
                <button class="close-btn" onclick="game.closePetSelect()">Close</button>
            </div>
        </div>
    </div>

    <script>
        class Game {
            constructor() {
                this.stats = {
                    hunger: 80,
                    energy: 80,
                    fun: 80,
                    hygiene: 80
                };

                this.xp = 0;
                this.level = 1;
                this.xpToNext = 100;
                this.coins = 50; // Starting coins
                this.isSleeping = false;
                this.isDead = false;

                this.loopId = null;
                this.decayRates = {
                    hunger: 0.05,
                    energy: 0.03,
                    fun: 0.04,
                    hygiene: 0.02
                };

                this.inventory = {
                    'treat': 0,
                    'toy': 0
                };

                this.activeAccessories = [];

                this.shopItems = [
                    { id: 'treat', name: 'Tasty Treat', icon: 'üç¨', price: 15, type: 'consumable', effect: 'hunger+50', desc: 'Restores 50% Hunger' },
                    { id: 'toy', name: 'Mouse Toy', icon: 'üêÅ', price: 25, type: 'consumable', effect: 'fun+50', desc: 'Restores 50% Fun' },
                    { id: 'bow', name: 'Red Bow', icon: 'üéÄ', price: 100, type: 'accessory', desc: 'A cute red bow' },
                    { id: 'glasses', name: 'Cool Glasses', icon: 'üòé', price: 150, type: 'accessory', desc: 'Stylish eyewear' },
                    { id: 'hat', name: 'Party Hat', icon: 'üé©', price: 200, type: 'accessory', desc: 'Time to party!' }
                ];

                this.petTypes = {
                    'cat': {
                        name: 'Cat',
                        variants: {
                            'orange': { name: 'Ginger', body: '#FFB86C', belly: '#FFEAA7' },
                            'black': { name: 'Void', body: '#6C5CE7', belly: '#A29BFE' },
                            'white': { name: 'Snow', body: '#DFE6E9', belly: '#FFFFFF' },
                            'grey': { name: 'Smokey', body: '#B2BEC3', belly: '#DFE6E9' }
                        },
                        shapes: {
                            ears: 'M 70 75 L 60 40 L 90 65 Z M 130 75 L 140 40 L 110 65 Z',
                            earInner: 'M 72 70 L 65 50 L 85 65 Z M 128 70 L 135 50 L 115 65 Z',
                            tail: 'M 140 150 Q 170 120 160 90'
                        }
                    },
                    'puppy': {
                        name: 'Puppy',
                        variants: {
                            'brown': { name: 'Cocoa', body: '#D3A986', belly: '#F3DCC7' },
                            'golden': { name: 'Goldie', body: '#F1C40F', belly: '#F9E79F' },
                            'spotted': { name: 'Spot', body: '#E0E0E0', belly: '#FFFFFF' }
                        },
                        shapes: {
                            ears: 'M 60 70 Q 50 90 70 100 L 75 80 Z M 140 70 Q 150 90 130 100 L 125 80 Z', // Floppy ears
                            earInner: '', // No inner ear visible for floppy
                            tail: 'M 140 140 Q 160 130 150 110' // Short tail
                        }
                    },
                    'unicorn': {
                        name: 'Unicorn',
                        variants: {
                            'pink': { name: 'Sparkle', body: '#FDA7DF', belly: '#F8EFBA' },
                            'blue': { name: 'Sky', body: '#74B9FF', belly: '#55E6C1' },
                            'white': { name: 'Magic', body: '#FFFFFF', belly: '#F8EFBA' }
                        },
                        shapes: {
                            ears: 'M 70 75 L 60 40 L 90 65 Z M 130 75 L 140 40 L 110 65 Z', // Pointy ears
                            earInner: 'M 72 70 L 65 50 L 85 65 Z M 128 70 L 135 50 L 115 65 Z',
                            tail: 'M 140 150 Q 170 120 160 90', // Fluffy tail (styled via CSS maybe?)
                            horn: 'M 95 60 L 100 30 L 105 60 Z'
                        }
                    }
                };

                this.currentPet = 'cat';
                this.currentVariant = 'orange';

                this.init();
            }

            init() {
                this.soundManager = new SoundManager();
                this.startGameLoop();
                this.updateUI();
                this.renderShop();
                this.renderPet();

                // Add click handler to cat
                document.getElementById('cat-svg').addEventListener('click', (e) => {
                    if (this.isDead) return;
                    this.spawnParticle(e.clientX, e.clientY, '‚ù§Ô∏è');
                    this.interact('pet');
                });

                // Add mute button
                const controls = document.querySelector('.controls');
                const muteBtn = document.createElement('button');
                muteBtn.className = 'btn';
                muteBtn.innerHTML = '<span class="btn-icon">üîä</span><span class="btn-label">Mute</span>';
                muteBtn.onclick = () => {
                    const isMuted = this.soundManager.toggleMute();
                    muteBtn.querySelector('.btn-icon').textContent = isMuted ? 'üîá' : 'üîä';
                    muteBtn.querySelector('.btn-label').textContent = isMuted ? 'Unmute' : 'Mute';
                };
                controls.appendChild(muteBtn);
                // Adjust grid columns for 5 buttons
                controls.style.gridTemplateColumns = 'repeat(5, 1fr)';
            }

            openPetSelect() {
                const modal = document.getElementById('cat-select-modal');
                const container = document.getElementById('cat-options');
                container.innerHTML = '';
                container.style.gridTemplateColumns = 'repeat(3, 1fr)'; // Adjust for more items

                // Render types and their variants
                Object.entries(this.petTypes).forEach(([typeKey, typeData]) => {
                    Object.entries(typeData.variants).forEach(([varKey, varData]) => {
                        const div = document.createElement('div');
                        div.className = `cat-option ${this.currentPet === typeKey && this.currentVariant === varKey ? 'selected' : ''}`;
                        div.onclick = () => this.selectPet(typeKey, varKey);

                        div.innerHTML = `
                            <div class="cat-preview" style="background: ${varData.body}; border: 4px solid ${varData.belly};"></div>
                            <div style="font-weight: bold; font-size: 0.8rem;">${varData.name}</div>
                            <div style="font-size: 0.7rem; opacity: 0.7;">${typeData.name}</div>
                        `;
                        container.appendChild(div);
                    });
                });

                modal.classList.add('visible');
            }

            closePetSelect() {
                document.getElementById('cat-select-modal').classList.remove('visible');
            }

            selectPet(type, variant) {
                this.currentPet = type;
                this.currentVariant = variant;
                this.renderPet();
                this.closePetSelect();
                this.showToast(`Selected ${this.petTypes[type].variants[variant].name}!`);
                this.soundManager.play('feed');
            }

            renderPet() {
                const typeData = this.petTypes[this.currentPet];
                const colors = typeData.variants[this.currentVariant];
                const shapes = typeData.shapes;
                const svg = document.getElementById('cat-svg');

                // Update Tail
                const tail = svg.querySelector('.cat-tail');
                if (tail) {
                    tail.setAttribute('d', shapes.tail);
                    tail.style.stroke = colors.body;
                }

                // Update Body/Head Colors
                svg.querySelectorAll('.cat-body').forEach(el => el.style.fill = colors.body);
                svg.querySelectorAll('.cat-belly').forEach(el => el.style.fill = colors.belly);

                // Handle Ears (Complex because count might change or shape is complex)
                const headGroup = svg.querySelector('g[transform="translate(0, -10)"]');

                // Remove old ears
                headGroup.querySelectorAll('.cat-ear, .cat-ear-inner, .unicorn-horn').forEach(e => e.remove());

                // Add new ears
                const newEars = document.createElementNS("http://www.w3.org/2000/svg", "path");
                newEars.setAttribute("d", shapes.ears);
                newEars.setAttribute("class", "cat-ear");
                newEars.style.fill = colors.body;
                headGroup.prepend(newEars);

                if (shapes.earInner) {
                    const newEarInner = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    newEarInner.setAttribute("d", shapes.earInner);
                    newEarInner.setAttribute("class", "cat-ear-inner");
                    newEarInner.style.fill = colors.belly;
                    // Insert after ears
                    newEars.after(newEarInner);
                }

                // Handle Unicorn Horn
                if (this.currentPet === 'unicorn' && shapes.horn) {
                    const horn = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    horn.setAttribute("d", shapes.horn);
                    horn.setAttribute("class", "unicorn-horn");
                    horn.style.fill = "#F1C40F"; // Gold horn
                    horn.style.stroke = "#F39C12";
                    horn.style.strokeWidth = "1";
                    headGroup.appendChild(horn); // Add on top
                }
            }

            startGameLoop() {
                if (this.loopId) clearInterval(this.loopId);
                this.loopId = setInterval(() => this.tick(), 100);
            }

            tick() {
                if (this.isDead) return;

                // Decay stats
                if (!this.isSleeping) {
                    this.stats.hunger = Math.max(0, this.stats.hunger - this.decayRates.hunger);
                    this.stats.energy = Math.max(0, this.stats.energy - this.decayRates.energy);
                    this.stats.fun = Math.max(0, this.stats.fun - this.decayRates.fun);
                    this.stats.hygiene = Math.max(0, this.stats.hygiene - this.decayRates.hygiene);
                } else {
                    // Regenerate energy while sleeping
                    this.stats.energy = Math.min(100, this.stats.energy + 0.2);
                    this.stats.hunger = Math.max(0, this.stats.hunger - (this.decayRates.hunger * 0.5));

                    // Wake up if full energy
                    if (this.stats.energy >= 100) {
                        this.toggleSleep(false);
                        this.showToast("Fully Rested!");
                    }
                }

                this.checkState();
                this.updateUI();
            }

            interact(action) {
                if (this.isDead) return;

                // Initialize audio context on first interaction
                if (this.soundManager.ctx.state === 'suspended') {
                    this.soundManager.ctx.resume();
                }

                if (this.isSleeping && action !== 'sleep') {
                    this.showToast("Zzz... (Wake up first)");
                    return;
                }

                const center = document.querySelector('.scene').getBoundingClientRect();
                const cx = center.left + center.width / 2;
                const cy = center.top + center.height / 2;

                let xpGain = 0;

                switch (action) {
                    case 'feed':
                        if (this.stats.hunger >= 95) {
                            this.showToast("Not hungry!");
                            return;
                        }
                        this.stats.hunger = Math.min(100, this.stats.hunger + 30);
                        this.stats.hygiene = Math.max(0, this.stats.hygiene - 5);
                        this.spawnParticle(cx, cy, 'üêü');
                        this.soundManager.play('feed');
                        xpGain = 10;
                        break;
                    case 'sleep':
                        this.toggleSleep(!this.isSleeping);
                        return;
                    case 'play':
                        if (this.stats.energy < 20) {
                            this.showToast("Too tired...");
                            return;
                        }
                        this.stats.fun = Math.min(100, this.stats.fun + 30);
                        this.stats.energy = Math.max(0, this.stats.energy - 15);
                        this.stats.hunger = Math.max(0, this.stats.hunger - 10);
                        this.spawnParticle(cx, cy, 'üß∂');
                        this.soundManager.play('play');
                        xpGain = 15;
                        break;
                    case 'clean':
                        if (this.stats.hygiene >= 95) {
                            this.showToast("Already clean!");
                            return;
                        }
                        this.stats.hygiene = Math.min(100, this.stats.hygiene + 40);
                        this.stats.fun = Math.max(0, this.stats.fun - 5);

                        // Digging Animation
                        const cat = document.getElementById('cat-svg');
                        cat.classList.add('animate-digging');

                        // Spawn Dust Clouds
                        for (let i = 0; i < 5; i++) {
                            setTimeout(() => {
                                this.spawnDust(cx + (Math.random() * 60 - 30), cy + 50);
                            }, i * 200);
                        }

                        setTimeout(() => {
                            cat.classList.remove('animate-digging');
                            this.spawnParticle(cx, cy, '‚ú®');
                        }, 1000);

                        this.soundManager.play('clean');
                        xpGain = 10;
                        break;
                    case 'pet':
                        this.stats.fun = Math.min(100, this.stats.fun + 5);
                        this.soundManager.play('purr');
                        xpGain = 2;
                        break;
                }

                this.gainXP(xpGain);
                this.updateUI();
            }

            spawnDust(x, y) {
                const dust = document.createElement('div');
                dust.className = 'dust-particle';
                const size = 10 + Math.random() * 20;
                dust.style.width = `${size}px`;
                dust.style.height = `${size}px`;
                dust.style.left = `${x}px`;
                dust.style.top = `${y}px`;
                document.body.appendChild(dust);
                setTimeout(() => dust.remove(), 1000);
            }

            buyItem(itemId) {
                const item = this.shopItems.find(i => i.id === itemId);
                if (!item) return;

                if (this.coins >= item.price) {
                    // Check if already owned accessory
                    if (item.type === 'accessory' && this.activeAccessories.includes(itemId)) {
                        this.showToast("Already wearing this!");
                        return;
                    }

                    this.coins -= item.price;
                    this.soundManager.play('feed'); // Use feed sound for purchase for now

                    if (item.type === 'consumable') {
                        this.useItem(item);
                    } else if (item.type === 'accessory') {
                        this.toggleAccessory(itemId);
                    }

                    this.updateUI();
                    this.renderShop();
                    this.showToast(`Bought ${item.name}!`);
                } else {
                    this.showToast("Not enough coins!");
                }
            }

            useItem(item) {
                if (item.effect === 'hunger+50') {
                    this.stats.hunger = Math.min(100, this.stats.hunger + 50);
                    this.spawnParticle(window.innerWidth / 2, window.innerHeight / 2, 'üç¨');
                } else if (item.effect === 'fun+50') {
                    this.stats.fun = Math.min(100, this.stats.fun + 50);
                    this.spawnParticle(window.innerWidth / 2, window.innerHeight / 2, 'üêÅ');
                }
            }

            toggleAccessory(id) {
                // Simple toggle: if wearing, remove. If not, add (and remove others of same type if needed)
                // For now, let's just allow one accessory at a time for simplicity or stack them?
                // Let's allow stacking different ones, but toggle off if clicked again?
                // Actually, let's just add it.
                if (!this.activeAccessories.includes(id)) {
                    this.activeAccessories.push(id);
                    this.renderAccessories();
                }
            }

            renderAccessories() {
                const container = document.getElementById('accessories-layer');
                container.innerHTML = '';

                this.activeAccessories.forEach(id => {
                    let el;
                    if (id === 'bow') {
                        el = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        el.setAttribute("d", "M 100 150 L 90 140 L 100 145 L 110 140 Z M 100 145 L 95 155 L 100 150 L 105 155 Z");
                        el.setAttribute("class", "cat-accessory accessory-bow");
                        // Adjust position to neck
                        el.setAttribute("transform", "translate(0, -5) scale(1.5) translate(-33, -48)");
                    } else if (id === 'glasses') {
                        el = document.createElementNS("http://www.w3.org/2000/svg", "g");
                        el.innerHTML = '<circle cx="85" cy="80" r="10" /><circle cx="115" cy="80" r="10" /><line x1="95" y1="80" x2="105" y2="80" />';
                        el.setAttribute("class", "cat-accessory accessory-glasses");
                    } else if (id === 'hat') {
                        el = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        el.setAttribute("d", "M 80 50 L 100 10 L 120 50 Z");
                        el.setAttribute("class", "cat-accessory accessory-hat");
                    }

                    if (el) container.appendChild(el);
                });
            }

            renderShop() {
                const container = document.getElementById('shop-items');
                container.innerHTML = '';

                this.shopItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = `shop-item ${this.coins < item.price ? 'disabled' : ''}`;
                    div.onclick = () => this.buyItem(item.id);

                    div.innerHTML = `
                <div class="item-icon">${item.icon}</div>
                <div class="item-details">
                    <div class="item-name">${item.name}</div>
                    <div class="item-desc">${item.desc}</div>
                </div>
                <div class="item-price">
                    <span>ü™ô</span> ${item.price}
                </div>
            `;
                    container.appendChild(div);
                });

                document.getElementById('coin-display').textContent = this.coins;
            }

            toggleSleep(sleeping) {
                this.isSleeping = sleeping;
                const cat = document.getElementById('cat-svg');
                const eyes = document.querySelector('.animate-blink');

                if (sleeping) {
                    cat.classList.remove('animate-float');
                    eyes.style.animation = 'none';
                    eyes.style.transform = 'scaleY(0.1)';
                    this.showToast("Goodnight!");
                    this.soundManager.play('sleep');
                } else {
                    cat.classList.add('animate-float');
                    eyes.style.animation = '';
                    eyes.style.transform = '';
                    this.showToast("Good Morning!");
                    this.soundManager.play('play'); // Wake up sound
                }
            }

            gainXP(amount) {
                this.xp += amount;
                if (this.xp >= this.xpToNext) {
                    this.levelUp();
                }
            }

            levelUp() {
                this.level++;
                this.xp -= this.xpToNext;
                this.xpToNext = Math.floor(this.xpToNext * 1.5);

                // Award coins
                const coinReward = 20 * this.level;
                this.coins += coinReward;

                this.showToast(`Level Up! +${coinReward} Coins`);
                this.spawnParticle(window.innerWidth / 2, window.innerHeight / 2, '‚≠ê');
                this.soundManager.play('levelup');

                // Full restore on level up
                this.stats.hunger = 100;
                this.stats.energy = 100;
                this.stats.fun = 100;
                this.stats.hygiene = 100;

                this.updateUI();
                this.renderShop();
            }

            checkState() {
                // Check for game over
                if (this.stats.hunger <= 0 || this.stats.fun <= 0 || this.stats.hygiene <= 0) {
                    this.gameOver();
                }
            }

            gameOver() {
                this.isDead = true;
                clearInterval(this.loopId);

                const cat = document.getElementById('cat-svg');
                cat.classList.remove('animate-float');
                cat.querySelector('.animate-breathe').classList.remove('animate-breathe');
                cat.classList.add('animate-run-away');

                this.soundManager.play('gameover');

                // Wait for animation to finish before showing dialog
                setTimeout(() => {
                    document.getElementById('game-over').classList.add('visible');
                }, 2000);
            }

            restart() {
                this.stats = { hunger: 80, energy: 80, fun: 80, hygiene: 80 };
                this.xp = 0;
                this.level = 1;
                this.xpToNext = 100;
                this.coins = 50;
                this.activeAccessories = [];
                this.renderAccessories();

                this.isSleeping = false;
                this.isDead = false;

                const cat = document.getElementById('cat-svg');
                cat.classList.remove('animate-run-away');
                cat.classList.add('animate-float');
                cat.querySelector('g').classList.add('animate-breathe'); // Re-add breathe to inner group

                document.getElementById('game-over').classList.remove('visible');

                // Remove mute button to avoid duplicates on re-init (or just reset state)
                const controls = document.querySelector('.controls');
                if (controls.children.length > 4) {
                    controls.lastChild.remove();
                    controls.style.gridTemplateColumns = 'repeat(4, 1fr)';
                }

                this.init();
                this.soundManager.play('levelup'); // Start sound
            }

            updateUI() {
                // Update Stats
                this.updateBar('hunger', this.stats.hunger);
                this.updateBar('energy', this.stats.energy);
                this.updateBar('fun', this.stats.fun);
                this.updateBar('hygiene', this.stats.hygiene);

                // Update XP
                const xpPct = (this.xp / this.xpToNext) * 100;
                document.getElementById('xp-bar').style.width = `${xpPct}%`;
                document.getElementById('level-display').textContent = this.level;

                // Update Coins
                document.getElementById('coin-display').textContent = this.coins;

                // Update Cat Mood
                const mouth = document.getElementById('mouth');
                const avgStat = (this.stats.hunger + this.stats.energy + this.stats.fun + this.stats.hygiene) / 4;

                if (this.isSleeping) {
                    // Sleeping mouth (small o)
                    mouth.setAttribute('d', 'M 98 98 A 2 2 0 1 1 102 98');
                } else if (avgStat > 70) {
                    // Happy
                    mouth.setAttribute('d', 'M 96 98 Q 100 102 104 98');
                } else if (avgStat > 40) {
                    // Neutral
                    mouth.setAttribute('d', 'M 96 100 L 104 100');
                } else {
                    // Sad
                    mouth.setAttribute('d', 'M 96 102 Q 100 98 104 102');
                }
            }

            updateBar(type, value) {
                const bar = document.getElementById(`${type}-bar`);
                const val = document.getElementById(`${type}-val`);

                bar.style.width = `${value}%`;
                val.textContent = `${Math.floor(value)}%`;

                // Color coding
                if (value > 60) bar.style.background = 'var(--success)';
                else if (value > 30) bar.style.background = 'var(--warning)';
                else bar.style.background = 'var(--danger)';
            }

            showToast(msg) {
                const toast = document.getElementById('toast');
                toast.textContent = msg;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            }

            spawnParticle(x, y, emoji) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = emoji;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        class SoundManager {
            constructor() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.muted = false;
                this.musicPlaying = false;
                this.musicInterval = null;
                this.noteIndex = 0;

                // Simple melody: C4, E4, G4, B4, A4, G4, E4, D4
                this.melody = [
                    261.63, 329.63, 392.00, 493.88,
                    440.00, 392.00, 329.63, 293.66
                ];
            }

            toggleMute() {
                this.muted = !this.muted;
                if (this.muted) {
                    this.ctx.suspend();
                    this.stopMusic();
                } else {
                    this.ctx.resume();
                    this.startMusic();
                }
                return this.muted;
            }

            startMusic() {
                if (this.musicPlaying || this.muted) return;

                // Ensure context is running
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume().then(() => {
                        this.musicPlaying = true;
                        this.playNextNote();
                        this.musicInterval = setInterval(() => this.playNextNote(), 800);
                    });
                } else {
                    this.musicPlaying = true;
                    this.playNextNote();
                    this.musicInterval = setInterval(() => this.playNextNote(), 800);
                }
            }

            stopMusic() {
                this.musicPlaying = false;
                if (this.musicInterval) clearInterval(this.musicInterval);
            }

            playNextNote() {
                if (this.muted) return;

                const freq = this.melody[this.noteIndex % this.melody.length];
                this.playTone(freq, 0.2, 0.1); // Increased volume and duration
                this.noteIndex++;
            }

            playTone(freq, duration, volume) {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();

                osc.type = 'sine';
                osc.frequency.value = freq;

                // Soft attack and release
                const now = this.ctx.currentTime;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(volume, now + 0.1);
                gain.gain.linearRampToValueAtTime(0, now + duration + 0.5);

                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.start();
                osc.stop(now + duration + 1);
            }

            play(type) {
                if (this.muted) return;

                // Resume context if suspended
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }

                // Start music on first interaction if not playing
                if (!this.musicPlaying) this.startMusic();

                switch (type) {
                    case 'feed': this.playFeed(); break;
                    case 'play': this.playJump(); break;
                    case 'clean': this.playSparkle(); break;
                    case 'sleep': this.playLullaby(); break;
                    case 'levelup': this.playFanfare(); break;
                    case 'gameover': this.playSad(); break;
                    case 'purr': this.playPurr(); break;
                }
            }

            // Sound Synthesis Methods

            playFeed() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, this.ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.1);

                // Second crunch
                setTimeout(() => {
                    const osc2 = this.ctx.createOscillator();
                    const gain2 = this.ctx.createGain();
                    osc2.type = 'triangle';
                    osc2.frequency.setValueAtTime(250, this.ctx.currentTime);
                    osc2.frequency.exponentialRampToValueAtTime(60, this.ctx.currentTime + 0.1);
                    gain2.gain.setValueAtTime(0.3, this.ctx.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);
                    osc2.connect(gain2);
                    gain2.connect(this.ctx.destination);
                    osc2.start();
                    osc2.stop(this.ctx.currentTime + 0.1);
                }, 150);
            }

            playJump() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(600, this.ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.2, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.2);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.2);
            }

            playSparkle() {
                const now = this.ctx.currentTime;
                for (let i = 0; i < 5; i++) {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800 + i * 200, now + i * 0.05);
                    gain.gain.setValueAtTime(0.1, now + i * 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.05 + 0.1);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start(now + i * 0.05);
                    osc.stop(now + i * 0.05 + 0.1);
                }
            }

            playLullaby() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(200, this.ctx.currentTime + 1);
                gain.gain.setValueAtTime(0.2, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 1);
            }

            playFanfare() {
                const now = this.ctx.currentTime;
                [440, 554, 659, 880].forEach((freq, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'square';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.1, now + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.3);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start(now + i * 0.1);
                    osc.stop(now + i * 0.1 + 0.3);
                });
            }

            playSad() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, this.ctx.currentTime + 1);
                gain.gain.setValueAtTime(0.2, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 1);
            }

            playPurr() {
                // Simple purr using low frequency sawtooth + noise approximation
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(25, this.ctx.currentTime);

                // AM Modulation for purr texture
                const lfo = this.ctx.createOscillator();
                lfo.type = 'sine';
                lfo.frequency.value = 10; // 10Hz purr rattle
                const lfoGain = this.ctx.createGain();
                lfoGain.gain.value = 50; // Depth of modulation

                lfo.connect(lfoGain);
                lfoGain.connect(osc.frequency);

                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.start();
                lfo.start();
                osc.stop(this.ctx.currentTime + 1);
                lfo.stop(this.ctx.currentTime + 1);
            }
        }

        // Start Game
        const game = new Game();
    </script>
</body>

</html>